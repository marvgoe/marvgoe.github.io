<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Bingo 2025</title>
  <style>
    :root{
      --bg:#0f172a; --card:#0b1220; --accent:#9b7dd9; --muted:#94a3b8; --win:#d8b4fe;
    }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, 'Helvetica Neue', Arial; margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#0f172a 0%, #1a1f3a 100%); color:#cbd5e1}
    .app{width:100%;max-width:960px;padding:16px;min-height:100vh;display:flex;flex-direction:column}
    header{display:flex;gap:16px;align-items:flex-start;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap}
    h1{font-size:clamp(16px, 5vw, 20px);margin:0}
    p.lead{margin:0;color:var(--muted);font-size:clamp(14px, 4vw, 16px); line-height:1.2}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;width:100%;justify-content:flex-end}    
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;color:#faf5ff;font-weight:600;cursor:pointer;font-size:clamp(12px, 3vw, 14px)}
    button.ghost{background:transparent;color:var(--muted);border:1px solid rgba(155,125,217,0.2)}
    select{background:#1e293b;border:1px solid rgba(155,125,217,0.2);padding:8px;border-radius:8px;color:#e0d5f0;font-size:clamp(12px, 3vw, 14px)}
    .config{display:flex;gap:8px;align-items:center;font-size:clamp(12px, 3vw, 13px)}

    .layout{display:grid;grid-template-columns:1fr;gap:18px}
    @media (min-width:900px){.layout{grid-template-columns:1fr 420px;}}

    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px}
    textarea{width:100%;height:220px;background:transparent;border:1px dashed rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:inherit;font-family:inherit;font-size:clamp(12px, 3vw, 13px)}
    label{font-size:clamp(11px, 3vw, 13px);color:var(--muted);display:block;margin-bottom:6px}

    .grid-wrap{display:grid;place-items:center;width:100%}
    .bingo-grid{display:grid;gap:8px;width:100%;max-width:640px;margin:0 auto}
    .cell{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;padding:6px;border-radius:8px;background:#1e293b;color:#cbd5e1;cursor:pointer;user-select:none;border:1px solid rgba(155,125,217,0.15);text-align:center;font-size:clamp(10px, 2.5vw, 13px);line-height:1.3;word-break:break-word}
    .cell.marked{background:linear-gradient(180deg,#9b7dd9,#7c3aed);color:#f1f5f9;box-shadow:0 6px 18px rgba(155,125,217,0.25);transform:scale(0.99)}
    .cell.free{background:linear-gradient(180deg,#9b7dd9,#6d4fa8);color:#f1f5f9;font-weight:700}
    .cell.bingo{background:linear-gradient(90deg,#9b7dd9, #7c3aed);color:#f1f5f9;box-shadow:0 0 30px rgba(155,125,217,0.8), inset 0 0 15px rgba(155,125,217,0.4);font-weight:700;animation:binoPulse 0.6s ease-in-out}
    .meta{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .meta .stat{background:rgba(255,255,255,0.02);padding:8px 10px;border-radius:8px;font-weight:600;font-size:clamp(12px, 3vw, 14px)}
    .footer-note{color:var(--muted);font-size:clamp(11px, 3vw, 12px);margin-top:8px}

    .bingo-win{padding:10px;border-radius:8px;background:linear-gradient(90deg,#34d399, #60a5fa);color:#052018;font-weight:800;margin-top:12px;font-size:clamp(14px, 4vw, 18px);text-align:center}

    /* small animations */
    .cell{transition:transform .12s ease, box-shadow .12s ease, background .12s ease}
    .cell:active{transform:scale(.95)}

    /* Touch-friendly adjustments */
    @media (hover: none) and (pointer: coarse) {
      .cell {
        min-height: 50px;
        min-width: 50px;
      }
      button {
        padding: 10px 14px;
        min-height: 44px;
      }
      select {
        min-height: 44px;
      }
    }

    /* Prevent zoom on input focus (iOS) */
    input, select, textarea {
      font-size: 16px;
    }

    /* Better spacing for small screens */
        @media (max-width: 480px) {
      .app {
        padding: 12px;
      }
      header {
        flex-direction: column;
        gap: 12px;
      }
      .controls {
        width: 100%;
        gap: 6px;
      }
      button {
        flex: 1;
        min-width: 50px;
        padding: 10px 8px;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .config {
        width: 100%;
      }
      .panel {
        padding: 12px;
      }
      .bingo-grid {
        gap: 6px;
      }
    }

    @keyframes binoPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Bingo Weihnachtsfeier 2025</h1>
        <p class="lead">W√∂rter einf√ºgen, mischen und per Klick markieren.</p>
      </div>
      <div class="controls">
        <div class="config">
          <label for="size">Gr√∂√üe</label>
          <select id="size">
            <option value="3">3 √ó 3</option>
            <option value="4" selected>4 √ó 4</option>
            <option value="5">5 √ó 5</option>
          </select>
        </div>
        <button id="shuffle">Mischen</button>
        <button id="reset" class="ghost">Zur√ºcksetzen</button>
      </div>
    </header>

    <main class="layout">
      <section class="panel">
        <label for="words">Wortliste (eine Zeile = ein Wort). Mindestens <span id="minWords">25</span></label>
        <textarea id="words">
"Ohne euch w√§re das alles nicht m√∂glich!"
Katja sorgt f√ºr Chaos
"Wir sind eine Familie/Gruppe/etc."
Jemand kotzt
Fremdscham beim Comedian
Jemand filmt mit dem Handy
Cringy Weihnachtspullover
Jemand singt laut mit
Bus verpasst!
Jemand erz√§hlt von seinem Hobby
Shorty sprengt den zeitlichen Rahmen
"Synergie",  "Out of the box", "KI"
"New Normal", "Digital", "Disruption"
"Werte Mitarbeiter" a la Alex
All-you-can-drink wird missbraucht
Selbstlob in den Himmel (111 J.)
Strolch mit komischen Jackett
Kalle sucht Anschluss
Getr√§nk kippt um
Legend√§re Weihnachtsfeier wird erw√§hnt
Story mit Overtime
Diskussion, die gar nicht dein Thema ist
Einfach mal "ja" sagen
"agil","Transformation", "Ver√§nderung"
Jemand kommt overdressed
Jemand kommt underdressed
        </textarea>

        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button id="apply">Anwenden</button>
          <button id="fillRandom" class="ghost">Mit Zufallsw√∂rtern auff√ºllen</button>
        </div>

      </section>

        <div id="winner" style="display:none" class="bingo-win"> <span id="bingoCount">1</span> BINGO! üéâ</div>
      <aside class="panel">
        <div class="grid-wrap">
          <div id="grid" class="bingo-grid" aria-live="polite"></div>
        </div>

        <div class="meta">
          <div class="stat">Markiert: <span id="markedCount">0</span></div>

        </div>
      </aside>
    </main>
  </div>

  <script>
    function shuffle(array){
      for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
      }
      return array;
    }

    const wordsEl = document.getElementById('words');
    const gridEl = document.getElementById('grid');
    const sizeEl = document.getElementById('size');
    const shuffleBtn = document.getElementById('shuffle');
    const resetBtn = document.getElementById('reset');
    const applyBtn = document.getElementById('apply');
    const fillRandomBtn = document.getElementById('fillRandom');
    const markedCountEl = document.getElementById('markedCount');
    const gridSizeEl = document.getElementById('gridSize');
    const minWordsEl = document.getElementById('minWords');
    const winnerEl = document.getElementById('winner');

    const filler = ['Pizza','Eis','Film','Programm','Code','Party','Urlaub','Zug','Flug','See','Berg','Brille','Schokolade','Tee','Rad','Fahrrad','Boot','Kino','Museum','Garten','Karte','Keks','Rezept','Chef','Chefkoch','Note','Test','Projekt','Meeting','Email'];

    function getWordsArray(){
      return wordsEl.value.split('\n').map(s=>s.trim()).filter(Boolean);
    }

    function ensureEnough(words,count){
      const out = [...words];
      let i=0;
      while(out.length<count){
        out.push(filler[i % filler.length] + (i>filler.length? ' '+Math.floor(i/filler.length):''));
        i++;
      }
      return out;
    }

    function buildGrid(){
      const n = Number(sizeEl.value);
      const needed = n*n;
      minWordsEl.textContent = needed;
      winnerEl.style.display = 'none';

      let words = getWordsArray();
      words = ensureEnough(words, needed);
      words = shuffle(words).slice(0,needed);

      // Save grid state
      localStorage.setItem('bingoGridState', JSON.stringify({
        words: words,
        size: n
      }));

      gridEl.style.gridTemplateColumns = `repeat(${n}, 1fr)`;
      gridEl.innerHTML = '';

      const centerIndex = Math.floor(needed/2);

      words.forEach((w,i)=>{
        const cell = document.createElement('button');
        cell.className = 'cell';
        cell.type = 'button';
        cell.dataset.index = i;
        cell.textContent = w;
        cell.addEventListener('click', ()=>{
          cell.classList.toggle('marked');
          updateStats();
        });

        if(n%2===1 && i===centerIndex){
          cell.classList.add('free','marked');
          cell.textContent = 'FREE';
        }

        gridEl.appendChild(cell);
      });

      updateStats();
    }

    function rebuildGridFromState(){
      const saved = localStorage.getItem('bingoGridState');
      if(saved){
        const state = JSON.parse(saved);
        sizeEl.value = state.size;
        
        gridEl.style.gridTemplateColumns = `repeat(${state.size}, 1fr)`;
        gridEl.innerHTML = '';

        const centerIndex = Math.floor(state.words.length / 2);

        state.words.forEach((w, i) => {
          const cell = document.createElement('button');
          cell.className = 'cell';
          cell.type = 'button';
          cell.dataset.index = i;
          cell.textContent = w;
          cell.addEventListener('click', ()=>{
            cell.classList.toggle('marked');
            updateStats();
          });

          if(state.size % 2 === 1 && i === centerIndex){
            cell.classList.add('free','marked');
            cell.textContent = 'FREE';
          }

          gridEl.appendChild(cell);
        });

        return true;
      }
      return false;
    }

    function updateStats(){
      const cells = Array.from(gridEl.querySelectorAll('.cell'));
      const marked = cells.filter(c=>c.classList.contains('marked')).length;
      markedCountEl.textContent = marked;
      saveProgress();
      checkWin(cells);
    }

    function saveProgress(){
      const cells = Array.from(gridEl.querySelectorAll('.cell'));
      const markedIndices = cells
        .map((cell, idx) => cell.classList.contains('marked') ? idx : -1)
        .filter(idx => idx !== -1);
      localStorage.setItem('bingoProgress', JSON.stringify(markedIndices));
    }

    function loadProgress(){
      const saved = localStorage.getItem('bingoProgress');
      if(saved){
        const markedIndices = JSON.parse(saved);
        const cells = Array.from(gridEl.querySelectorAll('.cell'));
        markedIndices.forEach(idx => {
          if(cells[idx] && !cells[idx].classList.contains('free')){
            cells[idx].classList.add('marked');
          }
        });
        updateStats();
      }
    }

    function checkWin(cells){
      const n = Number(sizeEl.value);
      if(cells.length===0) return;
      const m = [];
      for(let r=0;r<n;r++){
        const row = [];
        for(let c=0;c<n;c++){
          const idx = r*n + c;
          row.push(cells[idx].classList.contains('marked'));
        }
        m.push(row);
      }

      let bingo=false;
      let bingoCount = 0;
      const bingoIndices = new Set();

      for(let r=0;r<n;r++){
        if(m[r].every(Boolean)) {
          bingo=true;
          bingoCount++;
          for(let c=0;c<n;c++) bingoIndices.add(r*n + c);
        }
      }
      for(let c=0;c<n;c++){
        let ok=true;
        for(let r=0;r<n;r++){ if(!m[r][c]) ok=false; }
        if(ok) {
          bingo=true;
          bingoCount++;
          for(let r=0;r<n;r++) bingoIndices.add(r*n + c);
        }
      }
      let okDiag=true;
      for(let i=0;i<n;i++) if(!m[i][i]) okDiag=false;
      if(okDiag) {
        bingo=true;
        bingoCount++;
        for(let i=0;i<n;i++) bingoIndices.add(i*n + i);
      }
      okDiag=true;
      for(let i=0;i<n;i++) if(!m[n-1-i][i]) okDiag=false;
      if(okDiag) {
        bingo=true;
        bingoCount++;
        for(let i=0;i<n;i++) bingoIndices.add((n-1-i)*n + i);
      }

      cells.forEach((cell, idx) => {
        cell.classList.remove('bingo');
        if(bingo && bingoIndices.has(idx)) {
          cell.classList.add('bingo');
        }
      });

      if(bingo){
        document.getElementById('bingoCount').textContent = bingoCount;
        winnerEl.style.display = 'block';
      } else {
        winnerEl.style.display = 'none';
      }
    }

    shuffleBtn.addEventListener('click', buildGrid);
    sizeEl.addEventListener('change', buildGrid);
    applyBtn.addEventListener('click', buildGrid);
    resetBtn.addEventListener('click', ()=>{
      document.querySelectorAll('.cell').forEach(c=>{ if(!c.classList.contains('free')) c.classList.remove('marked'); });
      updateStats();
    });

    fillRandomBtn.addEventListener('click', ()=>{
      const n = Number(sizeEl.value);
      const needed = n*n;
      const cur = getWordsArray();
      const filled = ensureEnough(cur, needed);
      wordsEl.value = filled.slice(0, Math.max(needed, cur.length)).join('\n');
      buildGrid();
    });

    wordsEl.addEventListener('input', ()=>{
      localStorage.setItem('bingoWords', wordsEl.value);
    });

    const saved = localStorage.getItem('bingoWords');
    if(saved){ wordsEl.value = saved; }

    // Try to rebuild from saved state first
    if(!rebuildGridFromState()){
      buildGrid();
    }
    loadProgress();

    gridEl.addEventListener('keydown', (ev)=>{
      if(ev.key==='Enter' || ev.key===' '){
        ev.preventDefault();
        const t = ev.target;
        if(t.classList && t.classList.contains('cell')) t.click();
      }
    });
  </script>
</body>
</html>
